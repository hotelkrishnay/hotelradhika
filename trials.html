<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OTA Reverse Gross Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-xl bg-white rounded-2xl shadow-lg overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 text-white p-5 text-center">
      <h1 class="text-xl sm:text-2xl font-extrabold">Reverse Gross Calculator (Net → Gross)</h1>
      <p class="text-sm opacity-90 mt-1">Enter net in-hand and get the required base (gross) rate — step-by-step breakdown shown below.</p>
    </div>

    <div class="p-6">
      <!-- OTA Selector -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Select OTA</label>
        <select id="ota" onchange="setOTARules()" class="w-full px-3 py-2 border rounded-lg">
          <option value="">-- Choose OTA --</option>
          <option value="cleartrip">Cleartrip (20% + GST on comm, TCS 0.5, TDS 0.1)</option>
          <option value="gommt">GoMMT (20% + GST on comm, TCS 0.5, TDS 0.1)</option>
          <option value="yatra">Yatra (20% + GST on comm, TCS 0.5, TDS 0.1)</option>
          <option value="expedia">Expedia (18%, TCS 0.5, TDS 0.1)</option>
          <option value="agoda">Agoda (18%, TCS 0.5, TDS 0.1)</option>
          <option value="booking">Booking.com (15%, no TCS/TDS)</option>
        </select>
      </div>

      <!-- Net In-Hand -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Net In-Hand (₹)</label>
        <input id="netRate" type="number" step="any" placeholder="Enter net in-hand (e.g. 1000)" class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <!-- Discount editable -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Discount (%) — editable</label>
        <input id="discountInput" type="number" step="0.01" class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <!-- Rules display -->
      <div id="rulesDisplay" class="mb-4 text-sm text-gray-700"></div>

      <!-- Calculate -->
      <div class="mb-4">
        <button onclick="calculateGrossRate()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
          Calculate Gross Rate
        </button>
      </div>

      <!-- Result breakdown -->
      <div id="resultWrap" class="hidden bg-gray-50 border rounded-lg p-4">
        <h2 class="text-sm font-semibold text-gray-800 mb-3">Calculation Breakdown</h2>

        <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
          <div>Base Rate</div><div id="out_baseRate" class="font-medium"></div>

          <div>Minus - Discount (%)</div><div id="out_discountPct"></div>
          <div>Minus - Discount (₹)</div><div id="out_discountAmt"></div>

          <div class="pt-2">Selling Rate</div><div id="out_sellingRate" class="font-medium pt-2"></div>

          <div>Minus - OTA Commission (%)</div><div id="out_commPct"></div>
          <div>Minus - OTA Commission (₹)</div><div id="out_commAmt"></div>

          <div id="gstCommRowLabel">Minus - OTA Commission GST (₹)</div><div id="out_gstOnComm"></div>

          <div>Minus - TDS on Selling Rate (₹)</div><div id="out_tdsAmt"></div>
          <div>Minus - TCS on Selling Rate (₹)</div><div id="out_tcsAmt"></div>

          <div class="pt-2">BALANCE (Net In-Hand)</div><div id="out_balance" class="font-bold pt-2"></div>

          <div>Plus - GST on Selling Rate (5%)</div><div id="out_gstOnSelling"></div>

          <div class="pt-2">Gross We Receive</div><div id="out_grossWeReceive" class="font-semibold pt-2"></div>

          <div class="pt-2">We will pay to Government — GST on Selling Rate</div><div id="out_govtGst" class="pt-2"></div>

          <div class="pt-2">In Hand</div><div id="out_inHand" class="font-bold pt-2"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // OTA rules as per your latest table:
    // Note: commission & tcs/tds are percentages (not fractions)
    const otaRules = {
      cleartrip: { commissionPct: 20, gstOnCommission: true, tcsPct: 0.5, tdsPct: 0.1, defaultDiscountPct: 10 },
      gommt:     { commissionPct: 20, gstOnCommission: true, tcsPct: 0.5, tdsPct: 0.1, defaultDiscountPct: 10 },
      yatra:     { commissionPct: 20, gstOnCommission: true, tcsPct: 0.5, tdsPct: 0.1, defaultDiscountPct: 10 },

      // Per your spreadsheet "Agoda - Expedia" block uses 18% commission + TCS/TDS
      expedia:   { commissionPct: 18, gstOnCommission: false, tcsPct: 0.5, tdsPct: 0.1, defaultDiscountPct: 10 },
      agoda:     { commissionPct: 18, gstOnCommission: false, tcsPct: 0.5, tdsPct: 0.1, defaultDiscountPct: 10 },

      // Booking.com block from your sheet: 15% commission, no TCS/TDS
      booking:   { commissionPct: 15, gstOnCommission: false, tcsPct: 0.0, tdsPct: 0.0, defaultDiscountPct: 10 }
    };

    // Fixed property GST on Selling Rate (from your sheet) = 5%
    const PROPERTY_GST_PCT = 5;

    function setOTARules(){
      const otaKey = document.getElementById('ota').value;
      const rules = otaRules[otaKey];
      if(!rules){
        document.getElementById('rulesDisplay').innerText = '';
        document.getElementById('discountInput').value = '';
        return;
      }

      // Prefill discount
      document.getElementById('discountInput').value = rules.defaultDiscountPct;

      // Display rules summary
      document.getElementById('rulesDisplay').innerHTML = 
        `<strong>Commission:</strong> ${rules.commissionPct}% ${rules.gstOnCommission ? '+ 18% GST on commission' : ''} |
         <strong>TCS:</strong> ${rules.tcsPct}% |
         <strong>TDS:</strong> ${rules.tdsPct}% |
         <strong>Property GST (fixed):</strong> ${PROPERTY_GST_PCT}%`;

      // hide/show gst-on-commission label
      document.getElementById('gstCommRowLabel').style.display = rules.gstOnCommission ? 'block' : 'none';
    }

    // Helper formatter
    function fmt(v){ 
      if(isNaN(v)) return '₹0.0000';
      // format with thousands and 4 decimals (matches your sample precision)
      return '₹' + Number(v).toLocaleString('en-IN', {minimumFractionDigits:4, maximumFractionDigits:4});
    }

    function calculateGrossRate(){
      const otaKey = document.getElementById('ota').value;
      const rules = otaRules[otaKey];
      if(!rules){
        alert('Please select an OTA');
        return;
      }

      const netInHand = parseFloat(document.getElementById('netRate').value);
      if(isNaN(netInHand) || netInHand <= 0){
        alert('Enter valid Net In-Hand amount (e.g. 1000)');
        return;
      }

      // Discount editable (use entered value or default)
      let discountPct = parseFloat(document.getElementById('discountInput').value);
      if(isNaN(discountPct)) discountPct = rules.defaultDiscountPct;

      // percentages to fractions
      const c = rules.commissionPct / 100;        // OTA commission on S
      const gstOnC_rate = rules.gstOnCommission ? 0.18 : 0; // 18% on commission (if applies)
      const tds = rules.tdsPct / 100;             // TDS on S
      const tcs = rules.tcsPct / 100;             // TCS on S
      const d = discountPct / 100;                // discount on base rate (BR)
      const propGst = PROPERTY_GST_PCT / 100;     // GST on selling rate (hotel's GST, shown separately)

      // Deduction factor on S that reduces S to Net In-Hand (deducted from S)
      // netInHand = S - (S*c) - (S*c*gstOnC_rate) - (S*tds) - (S*tcs)
      // => netInHand = S * (1 - (c + c*gstOnC_rate + tds + tcs))
      const deductionOnS = c + (c * gstOnC_rate) + tds + tcs;
      const keepFactor = 1 - deductionOnS;
      if(keepFactor <= 0){
        alert('Rates produce invalid factor (check commission/GST/TDS/TCS).');
        return;
      }

      // Selling Rate S:
      const S = netInHand / keepFactor;

      // gross/base rate BR = S / (1 - d)
      if(d >= 1){
        alert('Discount must be less than 100%');
        return;
      }
      const BR = S / (1 - d);

      // Breakdown amounts
      const discountAmt = BR * d;              // BR * discount%
      const commissionAmt = S * c;             // S * commission%
      const gstOnCommissionAmt = commissionAmt * gstOnC_rate; // if applies
      const tdsAmt = S * tds;
      const tcsAmt = S * tcs;
      const balance = S - commissionAmt - gstOnCommissionAmt - tdsAmt - tcsAmt; // should be ~netInHand
      const gstOnSelling = S * propGst;
      const grossWeReceive = balance + gstOnSelling;

      // write to UI (4 decimals)
      document.getElementById('out_baseRate').innerText = fmt(BR);
      document.getElementById('out_discountPct').innerText = (discountPct.toFixed(2) + ' %');
      document.getElementById('out_discountAmt').innerText = fmt(discountAmt);

      document.getElementById('out_sellingRate').innerText = fmt(S);

      document.getElementById('out_commPct').innerText = (rules.commissionPct.toFixed(2) + ' %');
      document.getElementById('out_commAmt').innerText = fmt(commissionAmt);

      // GST on commission row (show 0 if not applicable)
      if(rules.gstOnCommission){
        document.getElementById('out_gstOnComm').innerText = fmt(gstOnCommissionAmt);
        document.getElementById('gstCommRowLabel').style.display = 'block';
      } else {
        document.getElementById('out_gstOnComm').innerText = fmt(0);
        document.getElementById('gstCommRowLabel').style.display = 'none';
      }

      document.getElementById('out_tdsAmt').innerText = fmt(tdsAmt);
      document.getElementById('out_tcsAmt').innerText = fmt(tcsAmt);

      document.getElementById('out_balance').innerText = fmt(balance);
      document.getElementById('out_gstOnSelling').innerText = fmt(gstOnSelling);
      document.getElementById('out_grossWeReceive').innerText = fmt(grossWeReceive);

      document.getElementById('out_govtGst').innerText = fmt(gstOnSelling);
      document.getElementById('out_inHand').innerText = fmt(balance);

      // show result block
      document.getElementById('resultWrap').classList.remove('hidden');
      // scroll into view on small screens
      document.getElementById('resultWrap').scrollIntoView({behavior:'smooth', block:'start'});
    }
  </script>
</body>
</html>
